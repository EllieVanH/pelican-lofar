<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE pelican>

<configuration version="1.0">

    <pipeline>
        <buffers>
           <SpectrumDataSetStokes>
               <buffer maxSize="100000000" maxChunkSize="100000000"/>
           </SpectrumDataSetStokes>
        </buffers>

        <adapters>
            <SigprocAdapter>
                <sampleSize bits="8"/>
                <channels number="1984" />
                <samplesPerRead number="1024" />
            </SigprocAdapter>
        </adapters>

        <clients>
            <FileDataClient>
                <data type="SpectrumDataSetStokes" adapter="SigprocAdapter" file="/local_data/Alfaburst/lofar8b_60s.fil"/>
            </FileDataClient>
        </clients>

        <pipelineConfig>
            <SigprocPipeline>
                <history value="2048" />
                <events min="2" max="100000000"/>
            </SigprocPipeline>
        </pipelineConfig>

        <modules>
	  <RFI_Clipper active="true" channelRejectionRMS="3.5"
                       spectrumRejectionRMS="6.0">
            <zeroDMing active="true" />
            <BandPassData file="/local_data/Alfaburst/lofar8btest.bp" />
            <Band matching="true" />
            <History maximum="100" />
	  </RFI_Clipper>            
          <DedispersionModule>
            <timeBinsPerBufferPow2 value="15" />
            <frequencyChannel1 MHz="148.828125"/>
            <sampleTime seconds="0.00032768"/>
            <channelBandwidth MHz="0.00305046"/>
            <dedispersionSamples value="3200" />
            <dedispersionStepSize value="0.1" />
            <dedispersionMinimum value="0.0" />
            <numberOfBuffers value="3" />
          </DedispersionModule>
          <DedispersionAnalyser>
            <detectionThreshold in_sigma="6.0" />
          </DedispersionAnalyser>
        </modules>

        <output>
	  <dataStreams>
	    <stream name="DedispersionDataAnalysis" listeners="DedispersionDataAnalysisOutput" />
	    <stream name="SigprocStokesWriter" listeners="SigprocStokesWriter" /> 
	  </dataStreams>
	  
	  <streamers>
	    <DedispersionDataAnalysisOutput active="true">
              <file name="/local_data/Alfaburst/dm" />
	    </DedispersionDataAnalysisOutput>
	    <SigprocStokesWriter active="true" writeHeader="true">
              <import file="/local_data/Alfaburst/mycommon.xml"/>
              <!--import file="/local_data/Alfaburst/lofar8btest-sigproc.xml"/-->
              <dataBits value="8"/>
              <tsamp value="0.00032768"/>
              <scale max="256" min="0"/>
              <topSubbandIndex value="250"/>
              <LBA_0_or_HBA_1 value="1" />
              <subbandsPerPacket value="31"/>
              <file filepath="/local_data/Alfaburst/l" />
              <params telescope="LOFAR" nPolsToWrite="1"/>
              <RAJ value="211324.3" />
              <DecJ value="464408.7"/>
              <TelescopeID value="1"/>
              <MachineID value="9"/>
	    </SigprocStokesWriter>
	  </streamers>
        </output>
	
    </pipeline>
</configuration>
